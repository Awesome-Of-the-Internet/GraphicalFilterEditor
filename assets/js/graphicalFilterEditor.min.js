'use strict';let cLib=null;function cancelEvent(a){a&&("isCancelled"in a&&(a.isCancelled=!0),"preventDefault"in a&&a.preventDefault(),"stopPropagation"in a&&a.stopPropagation());return!1}function lerp(a,b,d,e,c){return(c-a)*(e-b)/(d-a)+b}function zeroObject(a){for(let b in a)switch(typeof a[b]){case "function":break;case "boolean":a[b]=!1;break;case "number":a[b]=0;break;default:const d=a[b];Array.isArray(d)&&d.fill(null);a[b]=null}}
function setup(){window.CLib().then(a=>{cLib=a;window.main&&window.main()},a=>{alert(a);throw a;})}setup();
class PointerHandler{constructor(a,b=null,d=null,e=null){this.captured=!1;this.pointerId=-1;this.boundDocumentMove=this.boundDocumentUp=this.upCallback=this.moveCallback=this.downCallback=this.documentCancelEvent=this.documentUpEvent=this.documentMoveEvent=this.element=null;this.element=a;this.downCallback=b;this.moveCallback=d;this.upCallback=e;"onpointerdown"in a?(this.documentMoveEvent="pointermove",this.documentUpEvent="pointerup",this.documentCancelEvent="pointercancel",this.boundDocumentUp=
this.pointerUp.bind(this),this.boundDocumentMove=this.pointerMove.bind(this),a.onpointerdown=this.pointerDown.bind(this)):"ontouchstart"in a?(this.documentMoveEvent="touchmove",this.documentUpEvent="touchend",this.documentCancelEvent="touchcancel",this.boundDocumentUp=this.touchEnd.bind(this),this.boundDocumentMove=this.touchMove.bind(this),a.ontouchstart=this.touchStart.bind(this)):(this.documentMoveEvent="mousemove",this.documentUpEvent="mouseup",this.documentCancelEvent=null,this.boundDocumentUp=
this.mouseUp.bind(this),this.boundDocumentMove=this.mouseMove.bind(this),a.onmousedown=this.mouseDown.bind(this))}destroy(){this.mouseUp(null);zeroObject(this)}pointerDown(a){if(0<=this.pointerId&&"mouse"!==a.pointerType)return cancelEvent(a);const b=this.mouseDown(a);this.captured&&(this.pointerId=a.pointerId);return b}pointerMove(a){if(this.captured&&a.pointerId===this.pointerId)return this.mouseMove(a)}pointerUp(a){if(this.captured&&a.pointerId===this.pointerId)return this.pointerId=-1,this.mouseUp(a)}touchStart(a){if(!(1<
a.touches.length))return 0<=this.pointerId&&this.touchEnd(a),this.pointerId=1,a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,a=this.mouseDown(a),void 0===a&&(this.pointerId=-1),a}touchMove(a){if(this.captured&&!(1<a.touches.length))return a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,this.mouseMove(a)}touchEnd(a){if(this.captured&&!(0>this.pointerId))return this.pointerId=-1,this.mouseUp(a)}mouseDown(a){this.mouseUp(a);if(!(a.button||a.target&&a.target!==this.element)){if(this.downCallback&&
!this.downCallback(a))return cancelEvent(a);this.captured=!0;document.addEventListener(this.documentMoveEvent,this.boundDocumentMove,!0);document.addEventListener(this.documentUpEvent,this.boundDocumentUp,!0);this.documentCancelEvent&&document.addEventListener(this.documentCancelEvent,this.boundDocumentUp,!0);return cancelEvent(a)}}mouseMove(a){if(this.captured)return this.moveCallback&&this.moveCallback(a),cancelEvent(a)}mouseUp(a){if(this.captured)return document.removeEventListener(this.documentUpEvent,
this.boundDocumentUp,!0),document.removeEventListener(this.documentMoveEvent,this.boundDocumentMove,!0),this.documentCancelEvent&&document.removeEventListener(this.documentCancelEvent,this.boundDocumentUp,!0),this.captured=!1,this.upCallback&&this.upCallback(a),cancelEvent(a)}}
class GraphicalFilterEditor{constructor(a,b,d){if(8>a||a&a-1)throw"Sorry, class available only for fft sizes that are a power of 2 >= 8! :(";this.filterLength=a;this._sampleRate=b.sampleRate?b.sampleRate:44100;this._isNormalized=!1;this.binCount=(a>>>1)+1;this.filterKernel=b.createBuffer(2,a,this._sampleRate);this.audioContext=b;this.editorPtr=cLib._graphicalFilterEditorAlloc(this.filterLength,this._sampleRate);a=cLib.HEAP8.buffer;this.filterKernelBuffer=new Float32Array(a,cLib._graphicalFilterEditorGetFilterKernelBuffer(this.editorPtr),
GraphicalFilterEditor.MaximumFilterLength);this.channelCurves=[new Int32Array(a,cLib._graphicalFilterEditorGetChannelCurve(this.editorPtr,0),GraphicalFilterEditor.VisibleBinCount),new Int32Array(a,cLib._graphicalFilterEditorGetChannelCurve(this.editorPtr,1),GraphicalFilterEditor.VisibleBinCount)];this.actualChannelCurve=new Int32Array(a,cLib._graphicalFilterEditorGetActualChannelCurve(this.editorPtr),GraphicalFilterEditor.VisibleBinCount);this.visibleFrequencies=new Int32Array(a,cLib._graphicalFilterEditorGetVisibleFrequencies(this.editorPtr),
GraphicalFilterEditor.VisibleBinCount);this.equivalentZones=new Int32Array(a,cLib._graphicalFilterEditorGetEquivalentZones(this.editorPtr),GraphicalFilterEditor.EquivalentZoneCount);this.equivalentZonesFrequencyCount=new Int32Array(a,cLib._graphicalFilterEditorGetEquivalentZonesFrequencyCount(this.editorPtr),GraphicalFilterEditor.EquivalentZoneCount+1);this._convolver=b.createConvolver();this._convolver.normalize=!1;this.convolverCallback=d;this._convolver.buffer=this.filterKernel;this.updateFilter(0,
!0,!0);this.updateActualChannelCurve(0)}get sampleRate(){return this._sampleRate}get isNormalized(){return this._isNormalized}get convolver(){return this._convolver}destroy(){this.editorPtr&&(cLib._graphicalFilterEditorFree(this.editorPtr),zeroObject(this))}clampY(a){return a<=GraphicalFilterEditor.MaximumChannelValueY?GraphicalFilterEditor.MaximumChannelValueY:a>GraphicalFilterEditor.MinimumChannelValueY?GraphicalFilterEditor.ValidYRangeHeight+1:a}yToDB(a){return a<=GraphicalFilterEditor.MaximumChannelValueY?
40:a>GraphicalFilterEditor.MinimumChannelValueY?-Infinity:lerp(GraphicalFilterEditor.MaximumChannelValueY,40,GraphicalFilterEditor.MinimumChannelValueY,-40,a)}yToMagnitude(a){return a<=GraphicalFilterEditor.MaximumChannelValueY?100:a>GraphicalFilterEditor.MinimumChannelValueY?0:Math.exp(lerp(GraphicalFilterEditor.MaximumChannelValueY,2,GraphicalFilterEditor.MinimumChannelValueY,-2,a)*Math.LN10)}magnitudeToY(a){return 100<=a?GraphicalFilterEditor.MaximumChannelValueY:.01>a?GraphicalFilterEditor.ValidYRangeHeight+
1:Math.round(GraphicalFilterEditor.ZeroChannelValueY-GraphicalFilterEditor.ZeroChannelValueY*Math.log(a)/Math.LN10*.5-.4)}visibleBinToZoneIndex(a){if(a>=GraphicalFilterEditor.VisibleBinCount-1)return this.equivalentZones.length-1;if(0<a){const b=this.equivalentZonesFrequencyCount;for(let d=b.length-1;0<=d;d--)if(a>=b[d])return d}return 0}visibleBinToFrequency(a,b){const d=this.equivalentZones,e=this.visibleFrequencies;var c=GraphicalFilterEditor.VisibleBinCount;if(a>=c-1)return b?[e[c-1],d[d.length-
1]]:e[c-1];if(0<a)if(b){c=this.equivalentZonesFrequencyCount;for(let g=c.length-1;0<=g;g--)if(a>=c[g])return[e[a],d[g]]}else return e[a];return b?[e[0],d[0]]:e[0]}changeZoneY(a,b,d){b=this.visibleBinToZoneIndex(b);const e=this.equivalentZonesFrequencyCount[b+1];d=this.clampY(d);a=this.channelCurves[a];for(b=this.equivalentZonesFrequencyCount[b];b<e;b++)a[b]=d}updateBuffer(){if(this.convolverCallback){const a=this._convolver;this._convolver=this.audioContext.createConvolver();this._convolver.normalize=
!1;this._convolver.buffer=this.filterKernel;this.convolverCallback(a,this._convolver)}else this._convolver.buffer=this.filterKernel}copyFilter(a,b){this.filterKernel.copyToChannel(this.filterKernel.getChannelData(a),b);this._convolver&&this.updateBuffer()}updateFilter(a,b,d){cLib._graphicalFilterEditorUpdateFilter(this.editorPtr,a,this._isNormalized);this.filterKernel.copyToChannel(this.filterKernelBuffer,a);b?this.copyFilter(a,1-a):d?this.updateFilter(1-a,!1,!1):this._convolver&&this.updateBuffer()}updateActualChannelCurve(a){this.filterKernel.copyFromChannel(this.filterKernelBuffer,
a);cLib._graphicalFilterEditorUpdateActualChannelCurve(this.editorPtr,a)}changeFilterLength(a,b,d){return this.filterLength!==a?(this.filterLength=a,this.binCount=(a>>>1)+1,this.filterKernel=this.audioContext.createBuffer(2,a,this._sampleRate),cLib._graphicalFilterEditorChangeFilterLength(this.editorPtr,a),this.updateFilter(b,d,!0),!0):!1}changeSampleRate(a,b,d){return this._sampleRate!==a?(this._sampleRate=a,this.filterKernel=this.audioContext.createBuffer(2,this.filterLength,a),this.updateFilter(b,
d,!0),!0):!1}changeIsNormalized(a,b,d){return!this._isNormalized!==!a?(this._isNormalized=!!a,this.updateFilter(b,d,!0),!0):!1}changeAudioContext(a,b,d){if(this.audioContext!==a){var e=this._convolver;e&&e.disconnect(0);this.audioContext=a;this.filterKernel=a.createBuffer(2,this.filterLength,this._sampleRate);this._convolver=null;this.updateFilter(b,d,!0);this._convolver=a.createConvolver();this._convolver.normalize=!1;this._convolver.buffer=this.filterKernel;this.convolverCallback&&this.convolverCallback(e,
this._convolver);return!0}return!1}}GraphicalFilterEditor.VisibleBinCount=512;GraphicalFilterEditor.ValidYRangeHeight=255;GraphicalFilterEditor.ZeroChannelValueY=127;GraphicalFilterEditor.MaximumChannelValue=127;GraphicalFilterEditor.MinimumChannelValue=-127;GraphicalFilterEditor.MinusInfiniteChannelValue=-128;GraphicalFilterEditor.MaximumChannelValueY=0;GraphicalFilterEditor.MinimumChannelValueY=254;GraphicalFilterEditor.MaximumFilterLength=8192;GraphicalFilterEditor.EquivalentZoneCount=10;
class GraphicalFilterEditorControl{constructor(a,b,d){this.lblFrequency=this.lblCurve=this.lblCursor=this.mnuShowActual=this.mnuNormalizeCurves=this.mnuEditZones=this.mnuShowZones=this.mnuChR=this.mnuChBR=this.mnuChL=this.mnuChBL=this.mnu=this.btnMnu=this.labelImage=this.rangeImage=this.ctx=this.canvas=this.element=this.pointerHandler=null;this.editZones=this.showZones=!1;this.isActualChannelCurveNeeded=!0;this.currentChannelIndex=0;this.isSameFilterLR=!0;this.drawOffsetY=this.drawOffsetX=this.lastDrawY=
this.lastDrawX=this.drawingMode=0;if(8>a||a&a-1)throw"Sorry, class available only for fft sizes that are a power of 2 >= 8! :(";this.filter=new GraphicalFilterEditor(a,b,d)}destroy(){this.destroyControl();this.filter&&(this.filter.destroy(),zeroObject(this))}formatDB(a){return-40>a?"-Inf.":0>a?a.toFixed(2):0===a?"-"+a.toFixed(2):"+"+a.toFixed(2)}formatFrequency(a){return a[0]+" Hz ("+(1E3>a[1]?a[1]+" Hz":a[1]/1E3+" kHz")+")"}createControl(a){if(this.ctx)return!1;const b=()=>{const g=document.createElement("div");
g.className="GEMNUSEP";return g},d=g=>{const f=document.createElement("div");f.className="GEMNULBL";f.appendChild(document.createTextNode(g));return f},e=(g,f,k,h,n)=>{const m=document.createElement("div");m.className="GEMNUIT GECLK";f&&(f=document.createElement("span"),f.appendChild(document.createTextNode(h?"\u25cf ":"\u25a0 ")),k||(f.style.visibility="hidden"),m.appendChild(f));m.appendChild(document.createTextNode(g));n&&(m.onclick=n);return m};this.element=a;a.className="GE";this.boundMouseMove=
this.mouseMove.bind(this);this.canvas=document.createElement("canvas");this.canvas.className="GECV";this.canvas.width=GraphicalFilterEditorControl.ControlWidth;this.canvas.height=GraphicalFilterEditorControl.ControlHeight;this.canvas.addEventListener("mousemove",this.boundMouseMove);a.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d",{alpha:!1});this.pointerHandler=new PointerHandler(this.canvas,this.mouseDown.bind(this),this.mouseMove.bind(this),this.mouseUp.bind(this));a.oncontextmenu=
cancelEvent;this.canvas.oncontextmenu=cancelEvent;let c=document.createElement("div");c.className="GELBL";c.style.width="9em";c.appendChild(document.createTextNode("Cursor: "));c.appendChild(this.lblCursor=document.createElement("span"));c.appendChild(document.createTextNode(" dB"));this.lblCursor.appendChild(document.createTextNode("-0.00"));a.appendChild(c);c=document.createElement("div");c.className="GELBL";c.style.width="9em";c.appendChild(document.createTextNode("Curve: "));c.appendChild(this.lblCurve=
document.createElement("span"));c.appendChild(document.createTextNode(" dB"));this.lblCurve.appendChild(document.createTextNode("-0.00"));a.appendChild(c);c=document.createElement("div");c.className="GELBL";c.appendChild(document.createTextNode("Frequency: "));c.appendChild(this.lblFrequency=document.createElement("span"));this.lblFrequency.appendChild(document.createTextNode("0 Hz (31 Hz)"));a.appendChild(c);this.btnMnu=document.createElement("div");this.btnMnu.className="GEBTN GECLK";this.btnMnu.appendChild(document.createTextNode("\u25b2"));
this.btnMnu.onclick=this.btnMnu_Click.bind(this);a.appendChild(this.btnMnu);this.mnu=document.createElement("div");this.mnu.style.bottom=a.clientHeight-260+"px";this.mnu.className="GEMNU";this.mnu.style.display="none";this.mnu.appendChild(d("Same curve for both channels"));this.mnu.appendChild(this.mnuChBL=e("Use left curve",!0,!0,!0,this.mnuChB_Click.bind(this,0)));this.mnu.appendChild(this.mnuChBR=e("Use right curve",!0,!1,!0,this.mnuChB_Click.bind(this,1)));this.mnu.appendChild(b());this.mnu.appendChild(d("One curve for each channel"));
this.mnu.appendChild(this.mnuChL=e("Show left curve",!0,!1,!0,this.mnuChLR_Click.bind(this,0)));this.mnu.appendChild(this.mnuChR=e("Show right curve",!0,!1,!0,this.mnuChLR_Click.bind(this,1)));this.mnu.appendChild(b());this.mnu.appendChild(this.mnuShowZones=e("Show zones",!0,!1,!1,this.mnuShowZones_Click.bind(this)));this.mnu.appendChild(this.mnuEditZones=e("Edit by zones",!0,!1,!1,this.mnuEditZones_Click.bind(this)));this.mnu.appendChild(b());this.mnu.appendChild(this.mnuNormalizeCurves=e("Normalize curves",
!0,!1,!1,this.mnuNormalizeCurves_Click.bind(this)));this.mnu.appendChild(this.mnuShowActual=e("Show actual response",!0,!0,!1,this.mnuShowActual_Click.bind(this)));a.appendChild(this.mnu);this.rangeImage=this.ctx.createLinearGradient(0,0,1,this.canvas.height);this.rangeImage.addColorStop(0,"#ff0000");this.rangeImage.addColorStop(.1875,"#ffff00");this.rangeImage.addColorStop(.39453125,"#00ff00");this.rangeImage.addColorStop(.60546875,"#00ffff");this.rangeImage.addColorStop(.796875,"#0000ff");this.rangeImage.addColorStop(1,
"#ff00ff");a=this.drawCurve.bind(this);this.labelImage=new Image;this.labelImage.addEventListener("load",a);this.labelImage.addEventListener("error",a);this.labelImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAgCAYAAABpRpp6AAAAAXNSR0IArs4c6QAAAphJREFUWMPtl0tIVGEUx38zvdYZjVBEYBC1kB4EKa3auLEHtND4R6vaBC6MyVaVE0KWFlZE1qogOlEwgVQEgUKSVERFRhFEj4WLyESMFlKN0+YIl2HS6zyYgnvg8r+c73W+77vn+34XIovs3zBJWUnZubabX+SgDUAKWOeuV8BRM+svZAI5ringOzAEHDKzdwDxIoKtA+4Bv4FV/kwB9yVtLrRfM4t5XFVAJ9AIpEuxwklvnzKzLz6J48ADL2sKTG4L0AHUA5PAwCxBZ4EJSeeAU8CKUgRc7zoc8L10rcvZiQFgBNgKPAeWA7tm2L04sBg44K4ToQLOlxS+ZQAJ1/FA8fR7dcDXASwEWszsifs+Swo75jDwKFTAgeDCWr7606s9GPYblhTz2Ko9qR9KajKzdDGfxCiwzJNj1H1Vrl8D9Ra4/pxD4mWBX8CIpCSwD7gApONFBPzUdUPAtzGnDOCt6+oCx1nkmik26bqB7UBK0mv3HfOOewL1zgNXgC5J+33MMyGOzbhPsiuQC4Wfw2b22M/IGPDBnziwzcyGAvWuAq1ALfARuAhcC3EDZoBnntx7zOxyxAeRRRbxcJl5uNQTKCsPl8tKxsOSdvtNVgO8B46YWZ/DejewyZmi08wu5bQtGQ/HQwa7E7jht1k10A7cktQK9PsNlvA/kF5JzXl4eKXzcMIBf8ZrWdISoO2vPDwL+x52TZnZBHBbUq8zwySQNLMfknocupPAzbLy8Czsu971TcD3wvWOmY35+yfX2krz8DzX4OwbXe/mYd9MpXl4Gh9rfNuWAjtyVh9gbc6/XcV4uAe4DrRIavNTIQMcBE5KGvTka/f6pyvKw2ZmQIsD+5h31GBmZ4Fm7+wbsAbYa2Z9EQ//r/YHCOoe6W9/vj4AAAAASUVORK5CYII=";
return!0}destroyControl(){this.ctx&&(this.pointerHandler.destroy(),this.labelImage=this.rangeImage=this.ctx=this.mnuShowActual=this.mnuNormalizeCurves=this.mnuEditZones=this.mnuShowZones=this.mnuChR=this.mnuChBR=this.mnuChL=this.mnuChBL=this.mnu=this.btnMnu=this.lblFrequency=this.lblCurve=this.lblCursor=this.canvas=this.pointerHandler=null,this.element.parentNode.removeChild(this.element),this.boundMouseMove=this.element=null)}btnMnu_Click(a){a.button||("none"===this.mnu.style.display?(this.mnu.style.display=
"inline-block",this.btnMnu.replaceChild(document.createTextNode("\u25bc"),this.btnMnu.firstChild)):(this.mnu.style.display="none",this.btnMnu.replaceChild(document.createTextNode("\u25b2"),this.btnMnu.firstChild)));return!0}checkMenu(a,b){a.firstChild.style.visibility=b?"visible":"hidden";return b}mnuChB_Click(a,b){b.button||this.isSameFilterLR&&this.currentChannelIndex===a||(this.isSameFilterLR?(this.currentChannelIndex=a,this.filter.updateFilter(a,!0,!0),this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),
this.drawCurve()):(this.isSameFilterLR=!0,this.filter.copyFilter(a,1-a),this.currentChannelIndex!==a&&(this.currentChannelIndex=a,this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),this.drawCurve())),this.checkMenu(this.mnuChBL,0===a),this.checkMenu(this.mnuChL,!1),this.checkMenu(this.mnuChBR,1===a),this.checkMenu(this.mnuChR,!1));return!0}mnuChLR_Click(a,b){b.button||!this.isSameFilterLR&&this.currentChannelIndex===a||(this.isSameFilterLR&&(this.isSameFilterLR=!1,this.filter.updateFilter(1-
this.currentChannelIndex,!1,!1)),this.currentChannelIndex!==a&&(this.currentChannelIndex=a,this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),this.drawCurve()),this.checkMenu(this.mnuChBL,!1),this.checkMenu(this.mnuChL,0===a),this.checkMenu(this.mnuChBR,!1),this.checkMenu(this.mnuChR,1===a));return!0}mnuShowZones_Click(a){a.button||(this.showZones=!this.showZones,this.checkMenu(this.mnuShowZones,this.showZones),this.drawCurve());return!0}mnuEditZones_Click(a){a.button||(this.editZones=
!this.editZones,this.checkMenu(this.mnuEditZones,this.editZones));return!0}mnuNormalizeCurves_Click(a){a.button||(this.filter.changeIsNormalized(!this.filter.isNormalized,this.currentChannelIndex,this.isSameFilterLR),this.checkMenu(this.mnuNormalizeCurves,this.filter.isNormalized),this.isActualChannelCurveNeeded&&(this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve()));return!0}mnuShowActual_Click(a){a.button||(this.isActualChannelCurveNeeded=!this.isActualChannelCurveNeeded,
this.checkMenu(this.mnuShowActual,this.isActualChannelCurveNeeded),this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve());return!0}mouseDown(a){if(!a.button&&!this.drawingMode){const b=this.canvas.getBoundingClientRect(),d=a.clientX-b.left|0;a=a.clientY-b.top|0;if(0<=d&&d<GraphicalFilterEditorControl.ControlWidth)return this.canvas.removeEventListener("mousemove",this.boundMouseMove),this.drawingMode=1,this.editZones?this.filter.changeZoneY(this.currentChannelIndex,
d,a):(this.filter.channelCurves[this.currentChannelIndex][d]=this.filter.clampY(a),this.lastDrawX=d,this.lastDrawY=a),this.drawCurve(),!0}return!1}mouseMove(a){var b=this.canvas.getBoundingClientRect();let d=a.clientX-b.left|0;a=a.clientY-b.top|0;if(this.drawingMode||0<=d&&d<this.canvas.width&&0<=a&&a<this.canvas.height){b=this.filter.channelCurves[this.currentChannelIndex];0>d?d=0:d>=GraphicalFilterEditorControl.ControlWidth&&(d=GraphicalFilterEditorControl.ControlWidth-1);if(this.drawingMode){if(this.editZones)this.filter.changeZoneY(this.currentChannelIndex,
d,a);else{if(1<Math.abs(d-this.lastDrawX)){const e=(a-this.lastDrawY)/Math.abs(d-this.lastDrawX),c=d<this.lastDrawX?-1:1;let g=Math.abs(d-this.lastDrawX)-1;a=this.lastDrawY+e;for(d=this.lastDrawX+c;0<g;d+=c,g--)b[d]=this.filter.clampY(a),a+=e}b[d]=this.filter.clampY(a);this.lastDrawX=d;this.lastDrawY=a}this.drawCurve()}else this.isActualChannelCurveNeeded&&(b=this.filter.actualChannelCurve);this.lblCursor.replaceChild(document.createTextNode(GraphicalFilterEditorControl.prototype.formatDB(this.filter.yToDB(a))),
this.lblCursor.firstChild);this.lblCurve.replaceChild(document.createTextNode(GraphicalFilterEditorControl.prototype.formatDB(this.filter.yToDB(b[d]))),this.lblCurve.firstChild);this.lblFrequency.replaceChild(document.createTextNode(GraphicalFilterEditorControl.prototype.formatFrequency(this.filter.visibleBinToFrequency(d,!0))),this.lblFrequency.firstChild)}}mouseUp(a){this.drawingMode&&(this.canvas.addEventListener("mousemove",this.boundMouseMove),this.drawingMode=0,this.filter.updateFilter(this.currentChannelIndex,
this.isSameFilterLR,!1),this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve())}changeFilterLength(a){return this.filter.changeFilterLength(a,this.currentChannelIndex,this.isSameFilterLR)?(this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve(),!0):!1}changeSampleRate(a){return this.filter.changeSampleRate(a,this.currentChannelIndex,this.isSameFilterLR)?(this.isActualChannelCurveNeeded&&
this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve(),!0):!1}changeAudioContext(a){return this.filter.changeAudioContext(a,this.currentChannelIndex,this.isSameFilterLR)}drawCurve(){const a=this.ctx;if(a){var b=this.canvas,d=GraphicalFilterEditorControl.ControlWidth-1,e=this.filter.channelCurves[this.currentChannelIndex];a.fillStyle="#303030";a.fillRect(0,0,b.width,b.height);a.lineWidth=1;a.strokeStyle="#5a5a5a";a.beginPath();var c=b.width+1.5,g=GraphicalFilterEditor.ZeroChannelValueY+
.5;for(a.moveTo(c,g);0<c;)a.lineTo(c-4,g),c-=10,a.moveTo(c,g);a.stroke();a.drawImage(this.labelImage,0,0,44,16,b.width-44,GraphicalFilterEditor.ZeroChannelValueY-16,44,16);a.beginPath();c=b.width-1.5;g=GraphicalFilterEditor.ValidYRangeHeight+.5;for(a.moveTo(c,g);0<c;)a.lineTo(c-4,g),c-=10,a.moveTo(c,g);a.stroke();a.drawImage(this.labelImage,0,16,44,16,b.width-44,GraphicalFilterEditor.ValidYRangeHeight-16,44,16);if(this.showZones)for(b=this.filter.equivalentZonesFrequencyCount.length-2;0<b;b--){c=
this.filter.equivalentZonesFrequencyCount[b]+.5;g=GraphicalFilterEditor.MaximumChannelValueY+.5;a.beginPath();for(a.moveTo(c,g);g<GraphicalFilterEditor.MinimumChannelValueY;)a.lineTo(c,g+4),g+=10,a.moveTo(c,g);a.stroke()}a.strokeStyle=this.isActualChannelCurveNeeded&&!this.drawingMode?"#707070":this.rangeImage;a.beginPath();a.moveTo(.5,e[0]+.5);for(c=1;c<d;c++)a.lineTo(c+.5,e[c]+.5);a.lineTo(c+1,e[c]+.5);a.stroke();if(this.isActualChannelCurveNeeded&&!this.drawingMode){e=this.filter.actualChannelCurve;
a.strokeStyle=this.rangeImage;a.beginPath();a.moveTo(.5,e[0]+.5);for(c=1;c<d;c++)a.lineTo(c+.5,e[c]+.5);a.lineTo(c+1,e[c]+.5);a.stroke()}}}}GraphicalFilterEditorControl.ControlWidth=GraphicalFilterEditor.VisibleBinCount;GraphicalFilterEditorControl.ControlHeight=GraphicalFilterEditor.ValidYRangeHeight+5;
class Program{constructor(a,b,d){const e=[];var c=[];const g=[];this.gl=a;this.program=a.createProgram();this.vs=a.createShader(a.VERTEX_SHADER);this.fs=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(this.vs,b);a.compileShader(this.vs);if(!a.getShaderParameter(this.vs,a.COMPILE_STATUS))throw c="Vertex shader: "+a.getShaderInfoLog(this.vs),this.destroy(),alert(c),c;this.getAttribsAndUniforms(b,e,c,g);a.shaderSource(this.fs,d);a.compileShader(this.fs);if(!a.getShaderParameter(this.fs,a.COMPILE_STATUS))throw c=
"Fragment shader: "+a.getShaderInfoLog(this.fs),this.destroy(),alert(c),c;this.getAttribsAndUniforms(d,e,c,g);a.attachShader(this.program,this.vs);a.attachShader(this.program,this.fs);for(b=0;b<e.length;b++)a.bindAttribLocation(this.program,b,e[b]);a.linkProgram(this.program);for(a=0;a<c.length;a++)this.prepareUniform(c[a],g[a])}static create(a,b,d,e){const c=["webkit-3d","moz-webgl","webgl","experimental-webgl"];for(let g=0;g<c.length;g++)try{const f=a.getContext(c[g],b);return new Program(f,d,e)}catch(f){}return null}getAttribsAndUniforms(a,
b,d,e){a=a.split("\n");for(let n=0;n<a.length;n++){var c=a[n].trim();if("uniform"===c.substr(0,7)){c=c.split(" ");var g=c[1];for(var f=2;f<c.length;f++){var k=c[f];if(";"===k)break;var h=k.charAt(k.length-1);const m=";"===h;if(","===h||m)k=k.substr(0,k.length-1);","!==k&&k.length&&(d.push(k),e.push(g));if(m)break}}else if("attribute"===c.substr(0,9))for(c=c.split(" "),g=2;g<c.length;g++){f=c[g];if(";"===f)break;k=f.charAt(f.length-1);h=";"===k;if(","===k||h)f=f.substr(0,f.length-1);","!==f&&f.length&&
b.push(f);if(h)break}}}prepareUniform(a,b){const d=this.gl,e=d.getUniformLocation(this.program,a);if(!this[a])if("bool"===b||"int"===b||"sampler2D"===b)this[a]=function(c){d.uniform1i(e,c)};else if("float"===b)this[a]=function(c){d.uniform1f(e,c)};else if("vec2"===b)this[a]=function(c,g){d.uniform2f(e,c,g)},this[a+"v"]=function(c){d.uniform2fv(e,c)};else if("vec3"===b)this[a]=function(c,g,f){d.uniform3f(e,c,g,f)},this[a+"v"]=function(c){d.uniform3fv(e,c)};else if("vec4"===b)this[a]=function(c,g,f,
k){d.uniform4f(e,c,g,f,k)},this[a+"v"]=function(c){d.uniform4fv(e,c)};else if("mat4"===b)this[a]=function(c){d.uniformMatrix4fv(e,!1,c)};else return!1;return!0}use(){this.gl.useProgram(this.program)}destroy(){this.gl&&(this.gl.useProgram(null),this.vs&&(this.gl.detachShader(this.program,this.vs),this.gl.deleteShader(this.vs)),this.fs&&(this.gl.detachShader(this.program,this.fs),this.gl.deleteShader(this.fs)),this.program&&this.gl.deleteProgram(this.program),zeroObject(this))}}
class Analyzer{constructor(a,b,d,e,c,g){this.ctx=this.canvas=this.audioContext=null;this.alive=!1;this.lastRequest=0;this.boundAnalyze=null;this.audioContext=a;this.canvas=document.createElement("canvas");this.canvas.width=!c||0>=c?Analyzer.ControlWidth:c;this.canvas.height=!g||0>=g?Analyzer.ControlHeight:g;this.canvas.style.position="relative";this.canvas.style.margin="0px";this.canvas.style.padding="0px";this.canvas.style.verticalAlign="top";this.canvas.style.display="inline-block";this.canvas.style.cursor=
"default";d&&(this.canvas.id=d);this.ctx=e?null:this.canvas.getContext("2d",{alpha:!1});b.appendChild(this.canvas);this.boundAnalyze=f=>{this.alive?(this.lastRequest=requestAnimationFrame(this.boundAnalyze),this.analyze(f)):this.lastRequest=0}}destroy(){this.stop();this.cleanUp();this.canvas&&this.canvas.parentNode.removeChild(this.canvas);zeroObject(this)}start(){if(this.alive)return!1;this.alive=!0;this.lastRequest=requestAnimationFrame(this.boundAnalyze);return!0}stop(){this.alive=!1;this.lastRequest&&
(cancelAnimationFrame(this.lastRequest),this.lastRequest=0)}}Analyzer.ControlWidth=512;Analyzer.ControlHeight=512;Analyzer.colors="#000000 #0B00B2 #0C00B1 #0E00AF #0E00AF #0F00AE #1000AD #1200AC #1300AB #1500AB #1600AA #1700A9 #1900A8 #1A00A6 #1B00A6 #1D00A4 #1F00A3 #2000A1 #2200A1 #2300A0 #25009E #27009D #29009C #2B009A #2D0099 #2E0098 #300096 #320095 #340094 #360092 #380090 #39008F #3C008E #3E008C #40008B #420089 #440088 #470086 #480085 #4B0083 #4C0082 #4F0080 #51007F #54007C #56007C #57007A #5A0078 #5C0076 #5F0075 #610073 #640071 #65006F #68006E #6B006C #6D006A #6F0069 #710066 #740065 #760063 #790062 #7B0060 #7D005E #80005C #82005B #850059 #860057 #890056 #8C0054 #8E0052 #910050 #93004F #96004D #97004B #9A0049 #9C0048 #9F0046 #A10045 #A40043 #A60040 #A8003F #AA003E #AD003C #AF003A #B10039 #B30037 #B60035 #B80034 #BA0032 #BC0031 #BE002E #C1002D #C3002C #C5002A #C70028 #CA0027 #CB0025 #CE0024 #CF0023 #D10022 #D30020 #D6001E #D7001D #D9001B #DB001A #DD0019 #DF0017 #E10017 #E20015 #E40014 #E60012 #E70011 #E90010 #EA000F #EC000D #ED000C #EF000B #F1000B #F2000A #F40008 #F50007 #F60006 #F70005 #F90005 #F90003 #FB0003 #FC0002 #FD0001 #FE0001 #FF0000 #FF0100 #FF0200 #FF0300 #FF0500 #FF0600 #FF0600 #FF0800 #FF0900 #FF0B00 #FF0C00 #FF0D00 #FF0F00 #FF1000 #FF1200 #FF1400 #FF1500 #FF1700 #FF1900 #FF1A00 #FF1C00 #FF1D00 #FF2000 #FF2200 #FF2300 #FF2500 #FF2700 #FF2900 #FF2B00 #FF2D00 #FF2F00 #FF3100 #FF3400 #FF3500 #FF3700 #FF3900 #FF3C00 #FF3E00 #FF4000 #FF4200 #FF4400 #FF4700 #FF4900 #FF4B00 #FF4E00 #FF5000 #FF5200 #FF5500 #FF5700 #FF5900 #FF5C00 #FF5E00 #FF6100 #FF6300 #FF6600 #FF6800 #FF6A00 #FF6C00 #FF6F00 #FF7200 #FF7400 #FF7700 #FF7900 #FF7C00 #FF7E00 #FF8000 #FF8300 #FF8500 #FF8700 #FF8A00 #FF8D00 #FF8F00 #FF9200 #FF9500 #FF9700 #FF9900 #FF9B00 #FF9E00 #FFA000 #FFA300 #FFA500 #FFA700 #FFA900 #FFAC00 #FFAE00 #FFB100 #FFB200 #FFB600 #FFB700 #FFBA00 #FFBC00 #FFBE00 #FFC100 #FFC300 #FFC400 #FFC700 #FFC900 #FFCB00 #FFCD00 #FFCF00 #FFD100 #FFD300 #FFD500 #FFD700 #FFD900 #FFDB00 #FFDD00 #FFDE00 #FFE000 #FFE100 #FFE400 #FFE500 #FFE700 #FFE900 #FFEA00 #FFEB00 #FFED00 #FFEF00 #FFF000 #FFF100 #FFF300 #FFF400 #FFF500 #FFF600 #FFF800 #FFF900 #FFFA00 #FFFB00".split(" ");
class PlainAnalyzer extends Analyzer{constructor(a,b,d,e){super(a,b,e);this.sampleRate=d.sampleRate;this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=1024;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=1024;this.visibleFrequencies=d.visibleFrequencies;a=cLib.HEAP8.buffer;this.dataPtr=this.ptr=b=cLib._allocBuffer(19456+cLib._fftSizeOff(2048));this.data=new Uint8Array(a,b,1024);this.tmpPtr=b+=1024;this.tmp=new Float32Array(a,b,2048);this.windowPtr=b+=8192;this.window=new Float32Array(a,
b,1024);this.multiplierPtr=b+=4096;this.multiplier=new Float32Array(a,b,512);this.prevLPtr=b+=2048;this.prevL=new Float32Array(a,b,512);this.prevRPtr=b+=2048;this.prevR=new Float32Array(a,b,512);this.fft4gfPtr=b+2048;cLib._fftInitf(this.fft4gfPtr,2048);e=this.window;a=this.multiplier;const c=Math.PI;b=Math.exp;const g=Math.cos;d=1/Math.LN10;for(let f=0;1024>f;f++)e[f]=4*(.54-.46*g(2*c*f/1023));for(e=0;512>e;e++)a[e]=145*d*b(2.5*e/511)}analyze(a){a=this.multiplier;const b=this.tmp,d=this.ctx,e=this.sampleRate/
2048,c=this.visibleFrequencies,g=Analyzer.colors;var f;let k,h,n,m;this.analyzerL.getByteTimeDomainData(this.data);cLib._plainAnalyzer(this.fft4gfPtr,this.windowPtr,this.dataPtr,this.tmpPtr);let p=this.prevL;d.lineWidth=1;d.fillStyle="#000000";d.fillRect(0,0,512,512);for(h=k=0;511>h&&1024>k&&e>c[h+1]-c[h];){for(f=e*k;1024>k&&f+e<c[h];)k++,f=e*k;f=(4*p[h]+a[h]*lerp(f,b[k],f+e,b[k+1],c[h]))/2.5>>1;255<f?f=255:0>f&&(f=0);p[h]=f;d.beginPath();d.strokeStyle=g[f];d.moveTo(h-.5,256.5-f);d.lineTo(h-.5,256.5);
d.stroke();h++}for(k++;1024>k&&512>h;){m=n=0;do n+=b[k],m++,k++,f=e*k;while(f<c[h]&&1024>k);f=(4*p[h]+a[h]*n/m)/2.5>>1;255<f?f=255:0>f&&(f=0);p[h]=f;d.beginPath();d.strokeStyle=g[f];d.moveTo(h-.5,256.5-f);d.lineTo(h-.5,256.5);d.stroke();h++}this.analyzerR.getByteTimeDomainData(this.data);cLib._plainAnalyzer(this.fft4gfPtr,this.windowPtr,this.dataPtr,this.tmpPtr);p=this.prevR;for(h=k=0;511>h&&1024>k&&e>c[h+1]-c[h];){for(f=e*k;1024>k&&f+e<c[h];)k++,f=e*k;f=(4*p[h]+a[h]*lerp(f,b[k],f+e,b[k+1],c[h]))/
2.5>>1;255<f?f=255:0>f&&(f=0);p[h]=f;d.beginPath();d.strokeStyle=g[f];d.moveTo(h-.5,256.5);d.lineTo(h-.5,256.5+f);d.stroke();h++}for(k++;1024>k&&512>h;){m=n=0;do n+=b[k],m++,k++,f=e*k;while(f<c[h]&&1024>k);f=(4*p[h]+a[h]*n/m)/2.5>>1;255<f?f=255:0>f&&(f=0);p[h]=f;d.beginPath();d.strokeStyle=g[f];d.moveTo(h-.5,256.5);d.lineTo(h-.5,256.5+f);d.stroke();h++}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr)}}
class SoundParticlesAnalyzer extends Analyzer{constructor(a,b,d,e){super(a,b,e,!0,512,320);this.BG_COLUMNS=31;this.BG_PARTICLES_BY_COLUMN=16;this.BG_COUNT=this.BG_COLUMNS*this.BG_PARTICLES_BY_COLUMN;this.lastTime=0;this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=1024;this.analyzerL.maxDecibels=-12;this.analyzerL.minDecibels=-45;this.analyzerL.smoothingTimeConstant=0;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=1024;this.analyzerR.maxDecibels=-12;this.analyzerR.minDecibels=-45;
this.analyzerR.smoothingTimeConstant=0;a=(g,f)=>{this.COLORS[3*g]=f};b=(g,f)=>{this.COLORS[3*g+1]=f};d=(g,f)=>{this.COLORS[3*g+2]=f};this.processedDataPtr=this.ptr=e=cLib._allocBuffer(2240+8*this.BG_COUNT+8*this.BG_COUNT+this.BG_COUNT);this.processedData=new Uint8Array(512);this.processedDataRPtr=e+=512;this.processedDataR=new Uint8Array(512);this.fftPtr=e+=512;this.fft=new Float32Array(256);this.COLORSPtr=e+=1024;this.COLORS=new Float32Array(48);this.bgPosPtr=e+=192;this.bgPos=new Float32Array(2*
this.BG_COUNT);this.bgSpeedYPtr=e+=8*this.BG_COUNT;this.bgSpeedY=new Float32Array(this.BG_COUNT);this.bgThetaPtr=e+=4*this.BG_COUNT;this.bgTheta=new Float32Array(this.BG_COUNT);this.bgColorPtr=e+=4*this.BG_COUNT;this.bgColor=new Uint8Array(this.BG_COUNT);a(0,.75);b(0,0);d(0,0);a(1,0);b(1,.75);d(1,0);a(2,0);b(2,0);d(2,.75);a(3,.75);b(3,0);d(3,.75);a(4,.75);b(4,.75);d(4,0);a(5,0);b(5,.75);d(5,.75);a(6,.75);b(6,.75);d(6,.75);a(7,.75);b(7,.325);d(7,0);a(8,.75);b(8,0);d(8,.325);a(9,.325);b(9,.75);d(9,
0);a(10,0);b(10,.75);d(10,.325);a(11,0);b(11,.325);d(11,.75);a(12,.325);b(12,0);d(12,.75);a(13,0);b(13,0);d(13,.75);a(14,.75);b(14,.325);d(14,0);a(15,0);b(15,.325);d(15,.75);for(let g=0,f=0;g<this.BG_COLUMNS;g++)for(a=0;a<this.BG_PARTICLES_BY_COLUMN;a++,f++)this.fillBgParticle(f,-1.2+.01953125*(SoundParticlesAnalyzer.rand()&127));(this.program=Program.create(this.canvas,{alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0},SoundParticlesAnalyzer.VertexShaderSource,SoundParticlesAnalyzer.FragmentShaderSource))||
this.err("Apparently your browser does not support WebGL");this.program.use();this.program.texColor(0);this.program.aspect(.625,1);a=this.program.gl;e=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1]);const c=new Float32Array([0,1,1,1,0,0,1,0]);b=a.createBuffer();d=a.createBuffer();!a.getError()&&b&&d||this.err(-1);a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);a.clearColor(0,0,0,1);a.pixelStorei(a.UNPACK_ALIGNMENT,
2);a.disable(a.DEPTH_TEST);a.disable(a.CULL_FACE);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.disable(a.STENCIL_TEST);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE);a.blendEquation(a.FUNC_ADD);a.getError();e=a.createTexture();!a.getError()&&e||this.err(-2);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,e);a.getError()&&this.err(-3);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,
a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);this.fillTexture();a.getError()&&this.err(-4);a.enableVertexAttribArray(0);a.bindBuffer(a.ARRAY_BUFFER,b);a.vertexAttribPointer(0,4,a.FLOAT,!1,0,0);a.enableVertexAttribArray(1);a.bindBuffer(a.ARRAY_BUFFER,d);a.vertexAttribPointer(1,2,a.FLOAT,!1,0,0)}static rand(){return 65536*Math.random()|0}err(a){this.destroy();alert("Sorry! WebGL error :(\n"+a);throw a;}fillBgParticle(a,b){this.bgPos[a<<1]=.0078125*((SoundParticlesAnalyzer.rand()&
7)-4);this.bgPos[(a<<1)+1]=b;this.bgTheta[a]=.03125*(SoundParticlesAnalyzer.rand()&63);this.bgSpeedY[a]=.125+.00390625*(SoundParticlesAnalyzer.rand()&15);this.bgColor[a]=SoundParticlesAnalyzer.rand()&15}fillTexture(){const a=this.program.gl,b=Math.sqrt,d=new Uint8Array(4096),e=function(g,f,k){g=(k-g)/(f-g);return 0>=g?0:1<=g?1:g*g*(3-2*g)};for(let g=0;64>g;g++){let f=g-32;f*=f;for(let k=0;64>k;k++){var c=k-32;c=b(c*c+f)/30;1<c&&(c=1);let h=c;c=1-c;c*=c;c+=.5*c;.55>c?c=0:1>c&&(c=e(.55,1,c));h=1-h;
h=e(0,1,h);h*=h;h+=h;1<h&&(h=1);c+=.5*h;c=255*c|0;d[64*g+k]=255<=c?255:c}}a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,64,64,0,a.ALPHA,a.UNSIGNED_BYTE,d)}analyze(a){let b=a-this.lastTime;33<b&&(b=33);this.lastTime=a;a=this.program.gl;var d=.00390625*b,e=1-d;const c=this.processedData,g=this.processedDataR,f=this.fft,k=this.BG_COLUMNS,h=this.BG_PARTICLES_BY_COLUMN,n=this.COLORS,m=this.program,p=this.bgPos,w=this.bgSpeedY,x=this.bgColor,y=this.bgTheta,t=Math.max;let l,u=44,v=116;b*=.001;this.analyzerL.getByteFrequencyData(c);
this.analyzerR.getByteFrequencyData(g);for(l=0;256>l;l++){let q=t(c[l],g[l]);8>q&&(q=0);const r=f[l];q<r&&(q=d*q+e*r);f[l]=q;c[l]=255<=q?255:q}a.clear(a.COLOR_BUFFER_BIT);l=2;for(let q=0,r=0;q<k;q++){if(6>l)d=.00390625*c[l],l++;else if(20>l)d=.005859375*t(c[l],c[l+1]),l+=2;else if(36>l)d=.005859375*t(c[l],c[l+1],c[l+2],c[l+3]),l+=4;else if(100>l){for(d=0;l<u;l++)d=t(d,c[l]);d*=.0078125;u+=8}else{for(d=0;l<v;l++)d=t(d,c[l]);d*=.009765625;v+=16}m.amplitude(1<=d?1:d);m.baseX(-.9+.06206897*q);for(d=0;d<
h;d++,r++)1.2<p[(r<<1)+1]?this.fillBgParticle(r,-1.2):p[(r<<1)+1]+=w[r]*b,e=3*x[r],m.color(n[e],n[e+1],n[e+2]),e=r<<1,m.pos(p[e],p[e+1]),m.theta(y[r]),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr);this.program&&this.program.destroy()}}SoundParticlesAnalyzer.VertexShaderSource="precision mediump float;\nattribute vec4 inPosition;\nattribute vec2 inTexCoord;\nuniform float amplitude;\nuniform float baseX;\nuniform vec2 pos;\nuniform vec2 aspect;\nuniform vec3 color;\nuniform float theta;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\n\nvoid main() {\n\tfloat a = mix(0.0625, 0.34375, amplitude);\n\tfloat bottom = 1.0 - clamp(pos.y, -1.0, 1.0);\n\tbottom = bottom * bottom * bottom * 0.125;\n\ta = (0.75 * a) + (0.25 * bottom);\n\tgl_Position = vec4(baseX + pos.x + (5.0 * (pos.y + 1.0) * pos.x * sin((2.0 * pos.y) + theta)) + (inPosition.x * aspect.x * a), pos.y + (inPosition.y * aspect.y * a), 0.0, 1.0);\n\tvTexCoord = inTexCoord;\n\tvColor = color + bottom + (0.25 * amplitude);\n}";
SoundParticlesAnalyzer.FragmentShaderSource="precision lowp float;\nuniform sampler2D texColor;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\n\nvoid main() {\n\tfloat a = texture2D(texColor, vTexCoord).a;\n\tgl_FragColor = vec4(vColor.rgb * a, 1.0);\n}";
class WaveletAnalyzer extends Analyzer{constructor(a,b,d,e){super(a,b,e);this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=128;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=128;a=cLib.HEAP8.buffer;this.dataLPtr=this.ptr=b=cLib._allocBuffer(1536);this.dataL=new Uint8Array(a,b,128);this.dataRPtr=b+=128;this.dataR=new Uint8Array(a,b,128);this.tmpPtr=b+=128;this.tmp=new Float32Array(a,b,64);this.oL1Ptr=b+=256;this.oL1=new Float32Array(a,b,128);this.oR1Ptr=b+=512;this.oR1=new Float32Array(a,
b,128)}analyze(a){a=this.ctx;const b=Analyzer.colors,d=this.oL1,e=this.oR1;this.analyzerL.getByteTimeDomainData(this.dataL);this.analyzerR.getByteTimeDomainData(this.dataR);cLib._waveletAnalyzer(this.dataLPtr,this.dataRPtr,this.tmpPtr,this.oL1Ptr,this.oR1Ptr);let c,g,f=64,k=Analyzer.ControlWidth/64,h,n=0,m=Analyzer.ControlHeight-32;for(;;){c=f;for(h=0;512>h;)g=d[c],0>g&&(g=-g),g=127<=g?508:g<<2,a.fillStyle=b[g>>>1],a.fillRect(h,n,k,32),g=e[c],0>g&&(g=-g),g=127<=g?508:g<<2,a.fillStyle=b[g>>>1],a.fillRect(h,
m,k,32),c++,h+=k;k<<=1;n+=32;m-=32;if(!f)break;(f>>>=1)||(k=512)}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr)}};
